<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-green: #16a085;
            --light-green: #1abc9c;
            --dark-blue: #2c3e50;
            --light-gray: #f4f6f9;
            --white: #ffffff;
            --red: #e74c3c;
            --text-dark: #333;
            --text-light: #7f8c8d;
            --border-color: #ecf0f1;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Tajawal', 'Roboto', sans-serif;
            background-color: #dcdcdc;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            color: var(--text-dark);
        }

        .mobile-frame {
            width: 100%;
            max-width: 414px;
            height: 100vh; /* Use viewport height to fill the screen */
            background-color: var(--light-gray);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        @media (min-width: 415px) {
            body {
                align-items: center; /* Center frame on larger screens */
            }
            .mobile-frame {
                height: 896px;
                max-height: 95vh;
                border-radius: 40px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            }
        }

        .page {
            display: none;
            flex-direction: column;
            height: 100%;
            padding-bottom: 100px; /* Space for floating bottom nav */
            overflow: hidden; /* Changed from auto to prevent page scroll */
        }

        #home-page {
            overflow-y: hidden; /* Prevent scrolling on home page */
        }

        .page.active {
            display: flex;
        }

        /* Header */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            flex-shrink: 0;
        }

        .app-header h1 {
            font-size: 26px;
            font-weight: 700;
            color: #4c4c4c;
        }

        .header-s {
            color: #000000;
            font-weight: 900;
        }


        .header-icons {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 20px;
        }

        .avatar-sm {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
        }

        .back-btn {
            background: none;
            border: none;
            font-size: 22px;
            color: var(--text-dark);
            cursor: pointer;
            padding: 5px;
        }

        .header-placeholder {
            width: 32px; /* Match back-btn size for alignment */
        }


        /* Bottom Nav */
        .bottom-nav {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background-color: var(--dark-blue);
            display: flex;
            justify-content: space-around;
            padding: 8px;
            border-radius: 25px;
        }

        .nav-btn {
            background: none;
            border: none;
            color: var(--text-light);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            cursor: pointer;
            flex: 1;
            padding: 8px 5px;
            border-radius: 18px;
            transition: all 0.3s ease;
        }

        .nav-btn i {
            font-size: 22px;
        }

        .nav-btn.active {
            background-color: var(--primary-green);
            color: var(--white);
        }

        /* Home Page */
        #home-page {
            padding-left: 15px;
            padding-right: 15px;
        }
        .progres-card {
            border-radius: 20px;
            margin: 0 5px 8px;
            overflow: hidden;
            height: 80px; /* Match original banner height */
            flex-shrink: 0;
        }
        .progres-logo {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Cover the area nicely */
        }

        .services-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            padding: 0 5px;
            flex: 1; /* Make grid take remaining space */
            min-height: 0; /* Fix for flexbox overflow */
            grid-template-rows: repeat(7, 1fr); /* Distribute rows evenly */
        }
        .service-btn {
            background-color: var(--primary-green);
            color: var(--white);
            border: none;
            border-radius: 12px;
            padding: 6px 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.2s;
            height: 100%; /* Make buttons fill their grid cell */
        }

        .service-btn:hover {
            background-color: var(--light-green);
        }

        .service-btn i {
            font-size: 18px;
            width: 25px;
        }
        .service-btn.full-width {
            grid-column: 1 / -1;
        }
        
        /* Scrollable content areas for other pages */
        #discharge-page .discharge-content,
        #restoration-page .page-content-centered,
        #upload-cards-page .page-content-centered {
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }

        /* Discharge Page / Edit Form */
        .discharge-content {
            padding: 10px 20px 20px;
        }

        .edit-profile-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: 14px;
            color: var(--text-light);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input {
            border: 1px solid var(--border-color);
            background-color: var(--white);
            border-radius: 10px;
            padding: 14px;
            font-size: 16px;
            font-family: 'Tajawal', 'Roboto', sans-serif;
            outline: none;
            transition: border-color 0.2s;
            width: 100%;
        }
        .form-group input:focus {
            border-color: var(--primary-green);
        }

        .save-btn {
            background-color: var(--primary-green);
            color: var(--white);
            border: none;
            border-radius: 12px;
            padding: 16px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 10px;
        }

        .save-btn:hover {
            background-color: var(--light-green);
        }


        /* Restoration Page & Upload Cards Page */
        .page-content-centered {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            gap: 20px;
        }

        .huge-icon {
            font-size: 80px;
            color: var(--primary-green);
            opacity: 0.5;
        }

        .page-content-centered p {
            font-size: 16px;
            color: var(--text-light);
            max-width: 300px;
        }

        .action-btn {
            background-color: var(--primary-green);
            color: var(--white);
            border: none;
            border-radius: 12px;
            padding: 16px 32px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 10px;
            width: 100%;
            max-width: 300px;
        }

        .action-btn:hover {
            background-color: var(--light-green);
        }

        .upload-section {
            width: 100%;
            max-width: 300px;
            text-align: center;
        }

        .upload-section p {
            font-size: 16px;
            color: var(--text-dark);
            margin-bottom: 10px;
            font-weight: 500;
        }


        /* Cards Page - Flippable Card */
        .flippable-card-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            perspective: 1000px;
        }

        .flippable-card-inner {
            position: relative;
            width: 100%;
            max-width: 360px;
            aspect-ratio: 360 / 600;
            transition: transform 0.8s;
            transform-style: preserve-3d;
            cursor: pointer;
        }

        .flippable-card-inner.is-flipped {
            transform: rotateY(180deg);
        }

        .id-card {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            
            background-color: var(--white);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 15px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            direction: rtl; /* For Arabic text */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .flippable-card-back {
            transform: rotateY(180deg);
        }

        .id-card-header {
            display: flex;
            justify-content: center;
            text-align: center;
            margin-bottom: 20px;
            align-items: center;
            gap: 15px;
        }
        .gov-text {
            font-size: 11px;
            line-height: 1.5;
            font-weight: 500;
        }
        .onou-logo {
            width: 50px;
            height: 50px;
        }

        .id-card-body {
            display: flex;
            gap: 15px;
            flex: 1;
        }
        .id-card-main-content {
            flex: 1;
        }
        .card-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--primary-green);
        }
        .info-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 10px 15px;
            font-size: 13px;
        }
        .info-grid span:nth-child(odd) {
            font-weight: 500;
            color: var(--text-light);
        }
        .id-card-sidebar {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        .student-photo {
            width: 80px;
            height: 100px;
            border-radius: 8px;
            object-fit: cover;
            border: 3px solid var(--border-color);
        }
        .qr-code {
            width: 90px;
            height: 90px;
        }

        .id-card-footer {
          margin-top: auto;
          padding-top: 15px;
          font-size: 11px;
          text-align: center;
          font-weight: 500;
          display: flex;
          justify-content: space-between;
          align-items: center;
          direction: ltr;
        }

        /* Profile Page */
        #profile-page .profile-content {
            padding: 0 20px 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            min-height: 0;
        }
        .profile-summary-card {
            background: var(--primary-green);
            color: var(--white);
            border-radius: 20px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .avatar-lg {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid var(--white);
            object-fit: cover;
        }
        .profile-info h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        .profile-info p {
            font-size: 14px;
            opacity: 0.9;
        }

        .profile-details-card, .profile-action-card {
            background-color: var(--white);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .detail-item {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .detail-item i {
            font-size: 20px;
            color: var(--primary-green);
            width: 25px;
            text-align: center;
        }
        .detail-label {
            font-size: 12px;
            color: var(--text-light);
            margin-bottom: 2px;
        }
        .detail-value {
            font-size: 16px;
            font-weight: 500;
        }
        .profile-details-card hr {
            border: none;
            height: 1px;
            background-color: var(--border-color);
            margin: 15px 0;
        }

        .profile-action-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        .action-item {
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 500;
        }
        .action-item i {
            font-size: 20px;
            color: var(--primary-green);
            width: 25px;
            text-align: center;
        }
        .lang-btn {
            background: none;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px 12px;
            font-weight: 500;
            cursor: pointer;
        }
        .logout-btn {
            background-color: var(--red);
            color: var(--white);
            border: none;
            border-radius: 20px;
            padding: 18px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
            width: 100%;
            margin-top: 20px;
        }

        .logout-btn:hover {
            background-color: #c0392b;
        }

        /* RTL Styles */
        .mobile-frame.rtl {
            direction: rtl;
        }

        .mobile-frame.rtl .app-header {
            flex-direction: row-reverse;
        }

        .mobile-frame.rtl .profile-info,
        .mobile-frame.rtl .detail-item > div {
            text-align: right;
        }

        .mobile-frame.rtl .id-card-footer {
            direction: rtl;
        }

        .mobile-frame.rtl .form-group label {
            text-align: right;
        }
    </style>
</head>
<body>

    <div class="mobile-frame">

        <main id="home-page" class="page active">
            <header class="app-header">
                <h1 id="header-title-home"><span class="header-s">S</span>tudent Portal</h1>
                <div class="header-icons">
                    <i class="fa-regular fa-bell"></i>
                    <img src="https://i.postimg.cc/X7wz6fQ6/mami-hacker.jpg" alt="User Avatar" class="avatar-sm" id="header-avatar-sm">
                </div>
            </header>

            <section class="progres-card">
                <img src="https://i.postimg.cc/LXGY6MCf/IMG-2875.jpg" alt="Progres Card" class="progres-logo">
            </section>

            <section class="services-grid">
                <button class="service-btn" id="goto-discharge-btn"><i class="fa-solid fa-file-alt"></i><span id="service-discharge">Discharge</span></button>
                <button class="service-btn"><i class="fa-solid fa-calendar-alt"></i><span id="service-timetable">Timetable</span></button>
                <button class="service-btn"><i class="fa-solid fa-users"></i><span id="service-group">Group and Section</span></button>
                <button class="service-btn"><i class="fa-solid fa-calendar-check"></i><span id="service-exams-schedule">Exams Schedule</span></button>
                <button class="service-btn"><i class="fa-solid fa-graduation-cap"></i><span id="service-exam-grades">Exam Grades</span></button>
                <button class="service-btn"><i class="fa-solid fa-pencil-alt"></i><span id="service-assessment">Assessment</span></button>
                <button class="service-btn"><i class="fa-solid fa-chart-pie"></i><span id="service-percentage">Percentage (%)</span></button>
                <button class="service-btn"><i class="fa-solid fa-folder"></i><span id="service-transcripts">Academic transcripts</span></button>
                <button class="service-btn"><i class="fa-solid fa-calculator"></i><span id="service-debts">Debts</span></button>
                <button class="service-btn" id="goto-upload-cards-btn"><i class="fa-solid fa-id-card"></i><span id="service-upload-cards">Upload Card Images</span></button>
                <button class="service-btn"><i class="fa-solid fa-file-signature"></i><span id="service-enrollments">Enrollments</span></button>
                <button class="service-btn" id="goto-restoration-btn"><i class="fa-solid fa-utensils"></i><span id="service-restoration">Restoration</span></button>
                <button class="service-btn full-width"><i class="fa-solid fa-th-large"></i><span id="service-other">Other services</span></button>
            </section>
        </main>

        <main id="discharge-page" class="page">
            <header class="app-header">
                <button class="back-btn"><i class="fas fa-arrow-left"></i></button>
                <h1 id="header-title-discharge">Edit Profile</h1>
                <div class="header-placeholder"></div>
            </header>
            <section class="discharge-content">
                <form id="edit-profile-form" class="edit-profile-form">
                    <div class="form-group">
                        <label for="input-firstname" id="label-firstname">First Name</label>
                        <input type="text" id="input-firstname" required>
                    </div>
                    <div class="form-group">
                        <label for="input-lastname" id="label-lastname">Last Name</label>
                        <input type="text" id="input-lastname" required>
                    </div>
                     <div class="form-group">
                        <label for="input-university" id="label-university">University</label>
                        <input type="text" id="input-university" required>
                    </div>
                    <div class="form-group">
                        <label for="input-pob" id="label-pob-form">Place of Birth</label>
                        <input type="text" id="input-pob" required>
                    </div>
                    <div class="form-group">
                        <label for="input-dob" id="label-dob-form">Date of Birth</label>
                        <input type="date" id="input-dob" required>
                    </div>
                    <button type="submit" class="save-btn" id="save-changes-btn">Save Changes</button>
                </form>
            </section>
        </main>

        <main id="restoration-page" class="page">
            <header class="app-header">
                <button class="back-btn"><i class="fas fa-arrow-left"></i></button>
                <h1 id="header-title-restoration">Change Picture</h1>
                <div class="header-placeholder"></div>
            </header>
            <section class="page-content-centered">
                <i class="fa-solid fa-image-portrait huge-icon"></i>
                <p id="upload-prompt-text">Select a new photo for your profile and ID cards.</p>
                <button class="action-btn" id="upload-avatar-btn">Upload New Photo</button>
            </section>
        </main>
        
        <main id="upload-cards-page" class="page">
            <header class="app-header">
                <button class="back-btn"><i class="fas fa-arrow-left"></i></button>
                <h1 id="header-title-upload-cards">Upload Card Images</h1>
                <div class="header-placeholder"></div>
            </header>
            <section class="page-content-centered">
                <div class="upload-section">
                    <p id="upload-student-card-prompt">Student Card (Front)</p>
                    <button class="action-btn" id="upload-student-card-btn">Upload Image</button>
                </div>
                <div class="upload-section">
                    <p id="upload-residence-card-prompt">Residence Card (Back)</p>
                    <button class="action-btn" id="upload-residence-card-btn">Upload Image</button>
                </div>
            </section>
        </main>

        <main id="cards-page" class="page">
            <header class="app-header">
                <h1 id="header-title-cards">ID Cards</h1>
            </header>
            <div class="flippable-card-container">
              <div class="flippable-card-inner">
                  <div class="id-card flippable-card-front" id="card-1">
                      <!-- Card is intentionally left blank -->
                  </div>
                  <div class="id-card flippable-card-back" id="card-2">
                      <!-- Card is intentionally left blank -->
                  </div>
              </div>
            </div>
        </main>

        <main id="profile-page" class="page">
            <header class="app-header">
                <h1 id="header-title-profile">My Profile</h1>
            </header>
            <section class="profile-content">
                <div class="profile-summary-card">
                    <img src="https://i.postimg.cc/X7wz6fQ6/mami-hacker.jpg" alt="User Avatar" class="avatar-lg" id="profile-avatar-lg">
                    <div class="profile-info">
                        <h3 id="profile-name">MAMI HACKER</h3>
                        <p id="profile-university">université de béjaia</p>
                    </div>
                </div>

                <div class="profile-details-card">
                    <div class="detail-item">
                        <i class="fa-solid fa-map-marker-alt"></i>
                        <div>
                            <p class="detail-label" id="label-pob">Place of Birth</p>
                            <p class="detail-value" id="profile-pob">مجهول</p>
                        </div>
                    </div>
                    <hr>
                    <div class="detail-item">
                        <i class="fa-solid fa-calendar-day"></i>
                        <div>
                            <p class="detail-label" id="label-dob">Date of Birth</p>
                            <p class="detail-value" id="profile-dob">مجهول</p>
                        </div>
                    </div>
                </div>

                <div class="profile-action-card">
                    <div class="action-item">
                        <i class="fa-solid fa-language"></i>
                        <span id="action-change-lang">Change Language</span>
                    </div>
                    <button class="lang-btn">en-DZ</button>
                </div>

                <button class="logout-btn" id="logout-btn">LOGOUT</button>
            </section>
        </main>

        <nav class="bottom-nav">
            <button class="nav-btn active" data-target="home-page">
                <i class="fas fa-home"></i>
                <span id="nav-home">Home</span>
            </button>
            <button class="nav-btn" data-target="cards-page">
                <i class="fas fa-id-card"></i>
                <span id="nav-cards">Cards</span>
            </button>
            <button class="nav-btn" data-target="profile-page">
                <i class="fas fa-user"></i>
                <span id="nav-profile">Profile</span>
            </button>
        </nav>

    </div>

    <input type="file" id="avatar-upload-input" style="display: none;" accept="image/*">
    <input type="file" id="student-card-upload-input" style="display: none;" accept="image/*">
    <input type="file" id="residence-card-upload-input" style="display: none;" accept="image/*">
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const navButtons = document.querySelectorAll('.nav-btn');
            const pages = document.querySelectorAll('.page');

            // Sub-page navigation
            const homePage = document.getElementById('home-page');
            
            const gotoDischargeBtn = document.getElementById('goto-discharge-btn');
            const backBtnFromDischarge = document.querySelector('#discharge-page .back-btn');
            const dischargePage = document.getElementById('discharge-page');
            
            const gotoRestorationBtn = document.getElementById('goto-restoration-btn');
            const backBtnFromRestoration = document.querySelector('#restoration-page .back-btn');
            const restorationPage = document.getElementById('restoration-page');

            const gotoUploadCardsBtn = document.getElementById('goto-upload-cards-btn');
            const backBtnFromUploadCards = document.querySelector('#upload-cards-page .back-btn');
            const uploadCardsPage = document.getElementById('upload-cards-page');

            if (gotoDischargeBtn) {
                gotoDischargeBtn.addEventListener('click', () => {
                    homePage.classList.remove('active');
                    dischargePage.classList.add('active');
                    document.querySelector('.nav-btn.active')?.classList.remove('active');
                    populateEditForm();
                });
            }

            if (backBtnFromDischarge) {
                backBtnFromDischarge.addEventListener('click', () => {
                    dischargePage.classList.remove('active');
                    homePage.classList.add('active');
                    document.querySelector('.nav-btn[data-target="home-page"]')?.classList.add('active');
                });
            }

            if (gotoRestorationBtn) {
                gotoRestorationBtn.addEventListener('click', () => {
                    homePage.classList.remove('active');
                    restorationPage.classList.add('active');
                    document.querySelector('.nav-btn.active')?.classList.remove('active');
                });
            }

            if (backBtnFromRestoration) {
                backBtnFromRestoration.addEventListener('click', () => {
                    restorationPage.classList.remove('active');
                    homePage.classList.add('active');
                    document.querySelector('.nav-btn[data-target="home-page"]')?.classList.add('active');
                });
            }
            
            if (gotoUploadCardsBtn) {
                gotoUploadCardsBtn.addEventListener('click', () => {
                    homePage.classList.remove('active');
                    uploadCardsPage.classList.add('active');
                    document.querySelector('.nav-btn.active')?.classList.remove('active');
                });
            }

            if (backBtnFromUploadCards) {
                backBtnFromUploadCards.addEventListener('click', () => {
                    uploadCardsPage.classList.remove('active');
                    homePage.classList.add('active');
                    document.querySelector('.nav-btn[data-target="home-page"]')?.classList.add('active');
                });
            }

            // Bottom navigation logic
            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetPageId = button.getAttribute('data-target');

                    pages.forEach(page => page.classList.remove('active'));
                    navButtons.forEach(btn => btn.classList.remove('active'));

                    const targetPage = document.getElementById(targetPageId);
                    if (targetPage) {
                        targetPage.classList.add('active');
                    }
                    button.classList.add('active');
                });
            });

            // ID card swipe-to-flip logic
            const cardInner = document.querySelector('.flippable-card-inner');
            if (cardInner) {
                let isDragging = false;
                let startX = 0;
                let currentAngle = 0;
                let dragStartAngle = 0;
                let liveAngle = 0;

                const getPageX = (e) => {
                    if (e.touches) {
                        // Use changedTouches for touchend event
                        return e.touches[0] ? e.touches[0].pageX : e.changedTouches[0].pageX;
                    }
                    return e.pageX;
                };

                const onDragStart = (e) => {
                    isDragging = true;
                    startX = getPageX(e);
                    dragStartAngle = currentAngle;
                    cardInner.style.transition = 'none';
                    cardInner.style.cursor = 'grabbing';
                };

                const onDragging = (e) => {
                    if (!isDragging) return;
                    e.preventDefault(); // Prevents page scrolling on touch devices
                    
                    const currentX = getPageX(e);
                    const diffX = currentX - startX;
                    const rotationDelta = (diffX / cardInner.offsetWidth) * 180;
                    
                    liveAngle = dragStartAngle + rotationDelta;
                    cardInner.style.transform = `rotateY(${liveAngle}deg)`;
                };

                const onDragEnd = () => {
                    if (!isDragging) return;
                    isDragging = false;
                    cardInner.style.cursor = 'pointer';

                    cardInner.style.transition = 'transform 0.5s cubic-bezier(0.25, 1, 0.5, 1)';
                    
                    const finalAngle = Math.round(liveAngle / 180) * 180;
                    
                    currentAngle = finalAngle;
                    cardInner.style.transform = `rotateY(${finalAngle}deg)`;

                    const isFlipped = (currentAngle / 180) % 2 !== 0;
                    if (isFlipped) {
                        cardInner.classList.add('is-flipped');
                    } else {
                        cardInner.classList.remove('is-flipped');
                    }
                };

                cardInner.addEventListener('dragstart', (e) => e.preventDefault());

                // Mouse events
                cardInner.addEventListener('mousedown', onDragStart);
                window.addEventListener('mousemove', onDragging);
                window.addEventListener('mouseup', onDragEnd);

                // Touch events
                cardInner.addEventListener('touchstart', onDragStart, { passive: false });
                window.addEventListener('touchmove', onDragging, { passive: false });
                window.addEventListener('touchend', onDragEnd);
                window.addEventListener('touchcancel', onDragEnd);
            }

            // Language switcher logic
            const langToggleButton = document.querySelector('.profile-action-card');
            const langDisplay = document.querySelector('.lang-btn');
            const mobileFrame = document.querySelector('.mobile-frame');
            let currentLang = 'en';

            const translations = {
              en: {
                'nav-home': 'Home',
                'nav-cards': 'Cards',
                'nav-profile': 'Profile',
                'header-title-home': 'Student Portal',
                'service-discharge': 'Discharge',
                'service-timetable': 'Timetable',
                'service-group': 'Group and Section',
                'service-exams-schedule': 'Exams Schedule',
                'service-exam-grades': 'Exam Grades',
                'service-assessment': 'Assessment',
                'service-percentage': 'Percentage (%)',
                'service-transcripts': 'Academic transcripts',
                'service-debts': 'Debts',
                'service-upload-cards': 'Upload Card Images',
                'service-enrollments': 'Enrollments',
                'service-restoration': 'Restoration',
                'service-other': 'Other services',
                'header-title-cards': 'ID Cards',
                'header-title-profile': 'My Profile',
                'label-pob': 'Place of Birth',
                'label-dob': 'Date of Birth',
                'action-change-lang': 'Change Language',
                'logout-btn': 'LOGOUT',
                'header-title-discharge': 'Edit Profile',
                'label-firstname': 'First Name',
                'label-lastname': 'Last Name',
                'label-university': 'University',
                'label-pob-form': 'Place of Birth',
                'label-dob-form': 'Date of Birth',
                'save-changes-btn': 'Save Changes',
                'header-title-restoration': 'Change Picture',
                'upload-prompt-text': 'Select a new photo for your profile and ID cards.',
                'upload-avatar-btn': 'Upload New Photo',
                'header-title-upload-cards': 'Upload Card Images',
                'upload-student-card-prompt': 'Student Card (Front)',
                'upload-residence-card-prompt': 'Residence Card (Back)',
              },
              ar: {
                'nav-home': 'الرئيسية',
                'nav-cards': 'البطاقات',
                'nav-profile': 'الملف الشخصي',
                'header-title-home': 'بوابة الطالب',
                'service-discharge': 'براءة الذمة',
                'service-timetable': 'جدول التوقيت',
                'service-group': 'الفوج والفرع',
                'service-exams-schedule': 'جدول الامتحانات',
                'service-exam-grades': 'نقاط الإمتحان',
                'service-assessment': 'التقييم',
                'service-percentage': 'النسبة المئوية (%)',
                'service-transcripts': 'كشوف النقاط',
                'service-debts': 'الديون',
                'service-upload-cards': 'تحميل صور البطاقات',
                'service-enrollments': 'التسجيلات',
                'service-restoration': 'الإطعام',
                'service-other': 'خدمات أخرى',
                'header-title-cards': 'بطاقات التعريف',
                'header-title-profile': 'ملفي الشخصي',
                'label-pob': 'مكان الميلاد',
                'label-dob': 'تاريخ الميلاد',
                'action-change-lang': 'تغيير اللغة',
                'logout-btn': 'تسجيل الخروج',
                'header-title-discharge': 'تعديل الملف الشخصي',
                'label-firstname': 'الإسم',
                'label-lastname': 'اللقب',
                'label-university': 'الجامعة',
                'label-pob-form': 'مكان الميلاد',
                'label-dob-form': 'تاريخ الميلاد',
                'save-changes-btn': 'حفظ التغييرات',
                'header-title-restoration': 'تغيير الصورة',
                'upload-prompt-text': 'اختر صورة جديدة لملفك الشخصي وبطاقات الهوية.',
                'upload-avatar-btn': 'تحميل صورة جديدة',
                'header-title-upload-cards': 'تحميل صور البطاقات',
                'upload-student-card-prompt': 'بطاقة الطالب (الأمام)',
                'upload-residence-card-prompt': 'بطاقة الإقامة (الخلف)',
              }
            };

            const setLanguage = (lang) => {
                currentLang = lang;
                if (lang === 'ar') {
                    mobileFrame.classList.add('rtl');
                    langDisplay.textContent = 'ar-DZ';
                } else {
                    mobileFrame.classList.remove('rtl');
                    langDisplay.textContent = 'en-DZ';
                }

                Object.keys(translations[lang]).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.textContent = translations[lang][key];
                    }
                });
            };

            if (langToggleButton) {
                langToggleButton.addEventListener('click', () => {
                    const newLang = currentLang === 'en' ? 'ar' : 'en';
                    setLanguage(newLang);
                });
            }

            // User profile data management
            let currentUserData = {
                firstName: 'HACKER',
                lastName: 'MAMI',
                university: 'université de béjaia',
                pob: 'مجهول',
                dob: 'مجهول',
                avatarUrl: 'https://i.postimg.cc/X7wz6fQ6/mami-hacker.jpg'
            };

            const updateUserInfo = (user) => {
                const fullName = `${user.lastName} ${user.firstName}`;
                
                // Profile Page
                document.getElementById('profile-name').textContent = fullName;
                document.getElementById('profile-university').textContent = user.university;
                document.getElementById('profile-pob').textContent = user.pob;
                document.getElementById('profile-dob').textContent = user.dob;
                document.getElementById('profile-avatar-lg').src = user.avatarUrl;

                // Header
                document.getElementById('header-avatar-sm').src = user.avatarUrl;
            };

            // Edit profile form logic
            const editProfileForm = document.getElementById('edit-profile-form');

            const populateEditForm = () => {
                document.getElementById('input-firstname').value = currentUserData.firstName;
                document.getElementById('input-lastname').value = currentUserData.lastName;
                document.getElementById('input-university').value = currentUserData.university;
                document.getElementById('input-pob').value = currentUserData.pob;
                document.getElementById('input-dob').value = currentUserData.dob;
            };
            
            if (editProfileForm) {
                editProfileForm.addEventListener('submit', (event) => {
                    event.preventDefault();
                    
                    currentUserData = {
                        ...currentUserData,
                        firstName: document.getElementById('input-firstname').value,
                        lastName: document.getElementById('input-lastname').value,
                        university: document.getElementById('input-university').value,
                        pob: document.getElementById('input-pob').value,
                        dob: document.getElementById('input-dob').value,
                    };

                    updateUserInfo(currentUserData);
                    alert('Profile updated successfully!');
                    // Go back to home page after saving
                    backBtnFromDischarge.dispatchEvent(new Event('click'));
                });
            }

            // Avatar upload logic
            const uploadAvatarBtn = document.getElementById('upload-avatar-btn');
            const avatarUploadInput = document.getElementById('avatar-upload-input');

            if (uploadAvatarBtn && avatarUploadInput) {
                uploadAvatarBtn.addEventListener('click', () => {
                    avatarUploadInput.click();
                });

                avatarUploadInput.addEventListener('change', (event) => {
                    const target = event.target;
                    if (target.files && target.files[0]) {
                        const file = target.files[0];
                        const reader = new FileReader();

                        reader.onload = (e) => {
                            const newAvatarUrl = e.target.result;
                            currentUserData.avatarUrl = newAvatarUrl;
                            updateUserInfo(currentUserData);
                            alert('Avatar updated successfully!');
                            backBtnFromRestoration.dispatchEvent(new Event('click'));
                        };

                        reader.readAsDataURL(file);
                    }
                });
            }

            // Card image upload logic
            const uploadStudentCardBtn = document.getElementById('upload-student-card-btn');
            const studentCardUploadInput = document.getElementById('student-card-upload-input');
            const studentCard = document.getElementById('card-1');

            const uploadResidenceCardBtn = document.getElementById('upload-residence-card-btn');
            const residenceCardUploadInput = document.getElementById('residence-card-upload-input');
            const residenceCard = document.getElementById('card-2');

            const handleCardImageUpload = (file, cardElement) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const imageUrl = e.target.result;
                    cardElement.style.backgroundImage = `url(${imageUrl})`;
                    alert('Card image updated!');
                };
                reader.readAsDataURL(file);
            };

            if (uploadStudentCardBtn && studentCardUploadInput && studentCard) {
                uploadStudentCardBtn.addEventListener('click', () => studentCardUploadInput.click());
                studentCardUploadInput.addEventListener('change', (event) => {
                    const target = event.target;
                    if (target.files && target.files[0]) {
                        handleCardImageUpload(target.files[0], studentCard);
                    }
                });
            }

            if (uploadResidenceCardBtn && residenceCardUploadInput && residenceCard) {
                uploadResidenceCardBtn.addEventListener('click', () => residenceCardUploadInput.click());
                residenceCardUploadInput.addEventListener('change', (event) => {
                    const target = event.target;
                    if (target.files && target.files[0]) {
                        handleCardImageUpload(target.files[0], residenceCard);
                    }
                });
            }


            // Initialize the app with default user data and language
            updateUserInfo(currentUserData);
            setLanguage('en');
        });
    </script>
</body>
</html>